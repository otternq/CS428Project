<html>
	<head>

		<meta name="viewport" content="width=device-width, initial-scale=1">

		<script type="text/javascript">
			Clay = {};
			Clay.gameKey = "cs438";
			Clay.readyFunctions = [];
			Clay.options = { debug: true };
			Clay.ready = function( fn ) {
			    Clay.readyFunctions.push( fn );
			};
			( function() {
			    var clay = document.createElement("script");
			    clay.src = ( "https:" == document.location.protocol ? "https://" : "http://" ) + "clay.io/api/api.js"; 
			    var tag = document.getElementsByTagName("script")[0]; tag.parentNode.insertBefore(clay, tag);
			} )();
		</script>

		<script src="http://code.jquery.com/jquery-1.9.1.min.js" language="javascript"></script>
		<script src="/socket.io/socket.io.js"></script>
		<script  type="text/javascript" language="javascript">

			var socket = null;
			var stillY = false;
			var xState = 0;

			function printCors(data) {

				console.log(data);
				//alert(cors);

				$('#alpha span').html(data.alpha);
				$('#beta span').html(data.beta);
				$('#gamma span').html(data.gamma);

				if (data.gamma > -47 && data.gamma < 0) {
					console.log("increase velocity. gamma=" + data.gamma);
					socket.emit('up', {});
					stillX = false;
				} else if (data.gamma > 0) {
					console.log('decrease velocity. gamma=' + data.gamma);
					socket.emit('down', {});	
					stillX = false;
				} else {
					//console.log('std velocity gamma=' + data.gamma);
					//playerEntity.vel.y = playerEntity.constVelocity;

					if (stillX !== false) {
						socket.emit('stilly', {});
						stillY = true;
					}
						
				}

				if (data.beta > 15) {

					//console.log("Beta is moving box right. Possition: ");
					
					if (xState !== 1) {
						socket.emit('right', {});
						xState = 1;
					}

				} else if (data.beta < -15 ) {
					console.log("Beta is moving box left.");

					if (xState !== -1) {
						socket.emit('left', {});
						xState = -1;
					}
					
				} else {

					if (xState !== 0) {
						socket.emit('stillx', {});
						xState = 0;
					}

				}
			}

			function onOrientation(event) {
				var cor = {'alpha': event.alpha, 'beta': event.beta, 'gamma': event.gamma};
		        
		        printCors(cor);
			}

			function shoot() {
				socket.emit('shoot');
			}

			$(document).ready(function() {

				var requireClay = true; // If you pass true for 2nd param, it will make sure they've logged into clay (not anonymous)
				Clay.ready(function() {
					var requireClay = true; // If you pass true for 2nd param, it will make sure they've logged into clay (not anonymous)
					Clay.Player.requireLogin(function(){}, requireClay);

					Clay.Player.onUserReady(function( response ) {
				        //name= response.name; // name or 'Anonymous' if none
				        //identifier = response.identifier; // unique id associated with user (even if anonymous)
				        alert(response.name);

				        socket = io.connect('/room');

				        socket.emit('start', {
				        	'playerId': response.name,
				        	'clientType': 'remote'
				        });

						window.addEventListener('deviceorientation', onOrientation);


						$('#fire').on('touchstart', function() {
							shoot();
						});
				    });

				});
				
			});
			

		</script>
	</head>
	<body>

		<div id="fire" style="width:100%; height:100%; background-color:red;">Fire</div>

	</body>
</html>
