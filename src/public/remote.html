<html>
	<head>


		<script type="text/javascript">
			Clay = {};
			Clay.gameKey = "cs438";
			Clay.readyFunctions = [];
			Clay.options = { debug: true };
			Clay.ready = function( fn ) {
			    Clay.readyFunctions.push( fn );
			};
			( function() {
			    var clay = document.createElement("script");
			    clay.src = ( "https:" == document.location.protocol ? "https://" : "http://" ) + "clay.io/api/api.js"; 
			    var tag = document.getElementsByTagName("script")[0]; tag.parentNode.insertBefore(clay, tag);
			} )();
		</script>

		<script src="http://code.jquery.com/jquery-1.9.1.min.js" language="javascript"></script>
		<script src="/socket.io/socket.io.js"></script>
		<script type="text/javascript" src="js/gamecontroller.min.js"></script>
		<script  type="text/javascript" language="javascript">

			var socket = null;
			var stillY = false;
			var xState = 0;

			function printCors(data) {

				console.log(data);

				var stillX = true;
				var stillY = true;

				if (data.gamma > -47 && data.gamma < 0) {
					console.log("increase velocity. gamma=" + data.gamma);
					socket.emit('up', {});
					stillX = false;
				} else if (data.gamma > 0) {
					console.log('decrease velocity. gamma=' + data.gamma);
					socket.emit('down', {});	
					stillX = false;
				} else {
					//console.log('std velocity gamma=' + data.gamma);
					//playerEntity.vel.y = playerEntity.constVelocity;

					if (stillX !== false) {
						socket.emit('stilly', {});
						stillY = true;
					}
						
				}

				if (data.beta > 15) {

					//console.log("Beta is moving box right. Possition: ");
					
					if (xState !== 1) {
						socket.emit('right', {});
						xState = 1;
					}

				} else if (data.beta < -15 ) {
					console.log("Beta is moving box left.");

					if (xState !== -1) {
						socket.emit('left', {});
						xState = -1;
					}
					
				} else {

					if (xState !== 0) {
						socket.emit('stillx', {});
						xState = 0;
					}

				}
			}

			function onOrientation(event) {
				var cor = {'alpha': event.alpha, 'beta': event.beta, 'gamma': event.gamma};
		        
		        printCors(cor);
			}

			function shoot() {
				socket.emit('shoot');
			}

			$(document).ready(function() {

				var requireClay = true; // If you pass true for 2nd param, it will make sure they've logged into clay (not anonymous)
				Clay.ready(function() {
					var requireClay = true; // If you pass true for 2nd param, it will make sure they've logged into clay (not anonymous)
					Clay.Player.requireLogin(function(){}, requireClay);

					Clay.Player.onUserReady(function( response ) {
				        //name= response.name; // name or 'Anonymous' if none
				        //identifier = response.identifier; // unique id associated with user (even if anonymous)
				        //alert(response.name);

				        var controllerSettings = {
						    right: { 
						        position: { 
						            right: '5%' 
						        }, 
						        type: 'buttons', 
						        buttons: [
							        { 
							            label: 'fire', fontSize: 25, touchStart: function() { 
							                // do something 
							            },
							            radius: 40
							        }, 
							        false, 
							        false, 
							        false
						        ] 
						    }
						};

				        GameController.init(controllerSettings);

				        socket = io.connect('/room');

				        socket.emit('start', {
				        	'playerId': response.name,
				        	'clientType': 'remote'
				        });

						window.addEventListener('deviceorientation', onOrientation);
				    });

				});
				
			});
			

		</script>

	</head>
	<body>

		<canvas id="c2canvas" width="800" height="350">
			<!-- This text is displayed if the visitor's browser does not support HTML5.
			You can change it, but it is a good idea to link to a description of a browser
			and provide some links to download some popular HTML5-compatible browsers. -->
			<h1>Your browser does not appear to support HTML5.  Try upgrading your browser to the latest version.  <a href="http://www.whatbrowser.org">What is a browser?</a>
			<br/><br/><a href="http://www.microsoft.com/windows/internet-explorer/default.aspx">Microsoft Internet Explorer</a><br/>
			<a href="http://www.mozilla.com/firefox/">Mozilla Firefox</a><br/>
			<a href="http://www.google.com/chrome/">Google Chrome</a><br/>
			<a href="http://www.apple.com/safari/download/">Apple Safari</a><br/>
			<a href="http://www.google.com/chromeframe">Google Chrome Frame for Internet Explorer</a><br/></h1>
		</canvas>

	</body>
</html>
